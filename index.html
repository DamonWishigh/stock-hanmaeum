<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanmaeum Stock System</title>
    <style>
        :root { --primary: #1976d2; --secondary: #f44336; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .header { background: var(--primary); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header h2 { margin: 0; font-size: 1.5rem; }
        
        .sticky-controls { sticky: top; top: 0; background: var(--bg); z-index: 100; padding: 10px 0; }
        select { width: 100%; padding: 15px; border-radius: 8px; border: 2px solid var(--primary); font-size: 1.1rem; margin-bottom: 10px; }

        .card { background: white; padding: 18px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 6px solid var(--primary); }
        .item-title { font-size: 1.2rem; font-weight: bold; color: #333; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .starting-qty { font-size: 0.9rem; color: #666; margin-bottom: 12px; background: #e3f2fd; padding: 5px 10px; border-radius: 4px; display: inline-block; }
        
        .input-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .input-box { display: flex; flex-direction: column; }
        .input-box label { font-size: 0.8rem; margin-bottom: 4px; color: #555; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; text-align: center; font-size: 1rem; box-sizing: border-box; }
        input:focus { border-color: var(--primary); outline: none; background: #fffde7; }
        .waste-label { color: var(--secondary) !important; font-weight: bold; }

        .btn-submit { position: fixed; bottom: 20px; left: 15px; right: 15px; padding: 18px; background: #2e7d32; color: white; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .btn-submit:active { transform: scale(0.98); }
        #loading { text-align: center; padding: 20px; display: none; color: var(--primary); font-weight: bold; }
        .padding-bottom { height: 100px; }
    </style>
</head>
<body>

<div class="header">
    <h2>üì¶ Hanmaeum Stock Control</h2>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô 2026</p>
</div>

<div class="sticky-controls">
    <label>üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å (21-31):</label>
    <select id="selectedDate" onchange="fetchDataFromSheet()">
        <option value="21">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 21</option><option value="22">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 22</option><option value="23">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 23</option>
        <option value="24">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 24</option><option value="25">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25</option><option value="26">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 26</option>
        <option value="27">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 27</option><option value="28">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 28</option><option value="29">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 29</option>
        <option value="30">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 30</option><option value="31">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 31</option>
    </select>
</div>

<div id="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤...</div>
<div id="item-list"></div>
<div class="padding-bottom"></div>

<button class="btn-submit" onclick="saveData()">üöÄ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Excel</button>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzzeHi0NeCjYwzQ_rZ7dVSPrUQj1A_6GKxjH6zlzdIlHupuEXzlvwK6_HShVXfil1Z-Uw/exec';
    const items = [
    "‡∏ô‡πâ‡∏≥", "‡πÇ‡∏ã‡∏î‡∏≤", "‡πÇ‡∏Ñ‡πâ‡∏Å", "‡πÇ‡∏Ñ‡πâ‡∏Å‡∏ã‡∏µ‡πÇ‡∏£‡πà", "‡πÅ‡∏ü‡∏ô‡∏ï‡πâ‡∏≤‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°", "‡πÅ‡∏ü‡∏ô‡∏ï‡πâ‡∏≤‡∏≠‡∏á‡∏∏‡πà‡∏ô", 
    "‡∏™‡πÑ‡∏õ‡∏£‡∏ó‡πå", "‡∏™‡πÑ‡∏õ‡∏£‡∏ó‡πå‡∏ã‡∏µ‡πÇ‡∏£‡πà", "‡∏à‡∏¥‡∏ô‡πÇ‡∏£‡πà‡∏≠‡∏¥‡∏™‡πÅ‡∏ö‡∏•‡πá‡∏Ñ", "‡πÇ‡∏ã‡∏à‡∏π‡∏ä‡∏≤‡∏°‡∏¥‡∏ã‡∏¥‡∏•‡πÄ‡∏ü‡∏£‡∏ä", 
    "‡πÇ‡∏ã‡∏à‡∏π ‡∏≠‡∏µ‡∏ã‡∏¥‡∏• ‡∏Å‡∏£‡∏µ‡∏ô‡πÄ‡πÄ‡∏Å‡∏£‡∏õ", "‡πÇ‡∏ã‡∏à‡∏π ‡∏≠‡∏µ‡∏ã‡∏¥‡∏• ‡∏û‡∏µ‡∏ä", "‡πÇ‡∏ã‡∏à‡∏π ‡∏≠‡∏µ‡∏ã‡∏¥‡∏• ‡πÄ‡∏•‡∏°‡πà‡∏≠‡∏ô", 
    "‡πÇ‡∏ã‡∏à‡∏π ‡∏≠‡∏µ‡∏ã‡∏¥‡∏• ‡∏™‡∏ï‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà", "‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏ó‡∏≠‡∏£‡πà‡∏≤", "‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå‡∏™‡∏¥‡∏á‡∏´‡πå", "‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πâ‡∏≤‡∏á", 
    "Meridian", "‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏≠‡∏•‡∏•‡∏µ ‡∏ß‡∏≠‡∏•‡πÅ‡∏° ‡∏≠‡∏≠‡∏£‡∏¥‡∏à‡∏¥‡∏ô‡∏±‡∏•", "‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏≠‡∏•‡∏•‡∏µ ‡∏Å‡∏£‡∏µ‡∏ô‡πÄ‡πÄ‡∏Å‡∏£‡∏õ", 
    "‡∏≠‡∏¥‡∏°‡∏û‡∏±‡∏•‡∏ã‡∏¥‡∏ö‡πÇ‡∏ã‡∏à‡∏π", "‡πÇ‡∏Å‡∏•‡πÄ‡∏î‡πâ‡∏ô‡∏ö‡∏•‡∏π", "‡∏£‡∏¥‡πÄ‡∏à‡∏ô‡∏ã‡∏µ‡πà"
    ];

    async function fetchDataFromSheet() {
        const date = document.getElementById('selectedDate').value;
        const loader = document.getElementById('loading');
        const container = document.getElementById('item-list');
        
        loader.style.display = 'block';
        container.style.opacity = '0.5';

        try {
            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ "‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤" (Column C, H, M...)
            const response = await fetch(`${scriptURL}?date=${date}`);
            const startData = await response.json();
            
            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á [cite: 2026-01-21]
            const draft = JSON.parse(localStorage.getItem(`draft_v2_${date}`)) || {};
            
            renderItems(startData, draft);
        } catch (e) {
            console.error(e);
            alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏≤‡∏£ Deploy Web App");
            renderItems({}, {}); // Fallback render
        } finally {
            loader.style.display = 'none';
            container.style.opacity = '1';
        }
    }

    function renderItems(startData, draft) {
        const container = document.getElementById('item-list');
        container.innerHTML = '';
        
        items.forEach((item, index) => {
            const startQty = startData[item] || 0;
            const d = draft[item] || { add: 0, waste: 0, used: 0 };
            
            container.innerHTML += `
                <div class="card">
                    <div class="item-title"><span>${item}</span></div>
                    <div class="starting-qty">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤: <b>${startQty}</b></div>
                    <div class="input-grid">
                        <div class="input-box">
                            <label>‚ûï ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°</label>
                            <input type="number" id="add_${index}" value="${d.add}" oninput="updateLocal()">
                        </div>
                        <div class="input-box">
                            <label class="waste-label">‚ùå ‡πÄ‡∏™‡∏µ‡∏¢</label>
                            <input type="number" id="waste_${index}" value="${d.waste}" oninput="updateLocal()">
                        </div>
                        <div class="input-box">
                            <label>‚ûñ ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</label>
                            <input type="number" id="used_${index}" value="${d.used}" oninput="updateLocal()">
                        </div>
                    </div>
                </div>`;
        });
    }

    function updateLocal() {
        const date = document.getElementById('selectedDate').value;
        let draftData = {};
        items.forEach((item, index) => {
            draftData[item] = {
                add: document.getElementById(`add_${index}`).value,
                waste: document.getElementById(`waste_${index}`).value,
                used: document.getElementById(`used_${index}`).value
            };
        });
        localStorage.setItem(`draft_v2_${date}`, JSON.stringify(draftData));
    }

    async function saveData() {
        const date = document.getElementById('selectedDate').value;
        const btn = document.querySelector('.btn-submit');
        btn.disabled = true;
        btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

        let itemsToSend = [];
        items.forEach((itemName, index) => {
            itemsToSend.push({
                name: itemName,
                add: document.getElementById(`add_${index}`).value,
                waste: document.getElementById(`waste_${index}`).value,
                used: document.getElementById(`used_${index}`).value
            });
        });

        try {
            const res = await fetch(scriptURL, { 
                method: 'POST', 
                body: JSON.stringify({ selectedDate: date, items: itemsToSend })
            });
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà " + date + " ‡∏•‡∏á Excel ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        } catch (e) {
            alert("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e);
        } finally {
            btn.disabled = false;
            btn.innerText = "üöÄ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Excel";
        }
    }

    window.onload = fetchDataFromSheet;
</script>
</body>
</html>